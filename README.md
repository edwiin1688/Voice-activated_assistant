# Voice-activated_assistant
試做一個【語音助理】

## 快速啟動
1. **環境準備**：確保已安裝 **.NET 10 SDK**。
2. **啟動程式**：
   在專案根目錄執行以下指令：
   ```powershell
   cd Voice-activated_assistant
   dotnet run
   ```
3. **模型選擇**：啟動後可選擇以下兩種模型：
   - **選項 1：官方 Tiny 模型** (約 31MB)。若本地無檔案，程式會**自動下載**。
   - **選項 2：繁體中文微調模型** (約 74MB)。若本地無檔案，請參考下方連結**手動下載**後放至專案目錄。
4. **使用方式**：
   - 程式啟動後會自動監控麥克風。
   - **聲控自動啟動**：具備 **Pre-roll Buffer (400ms)** 技術，確保開頭單詞（如「嗨」）不被切斷。
   - **靜音自動結束**：說完話後若持續靜音 **1.5 秒**，程式會自動斷句並立即轉錄文字。
   - **狀態顯示**：畫面會顯示當前監聽的 **已過秒數**。
   - 按下鍵盤 **ESC** 鍵可安全停止並結束程式。

## 核心優化
本專案進行了多項深度優化，以提供更流暢的使用體驗：

1. **完全記憶體運作 (Zero-Disk Usage)**：
   - 移除傳統的實體 `.wav` 檔案寫入。
   - 音訊數據直接在記憶體中處理，轉錄完成後自動釋放，具備極高隱私性且不佔用硬碟空間。

2. **智慧語音偵測 (VAD)**：
   - 具備音量閾值過濾功能，能自動剔除背景雜訊。
   - 只有在捕捉到說話聲時才啟動錄音流。

3. **動態斷句 (Auto-Stop)**：
   - 加入靜音感應機制，取代傳統的固定時長錄音。
   - 說完話後立即進行轉譯，大幅提升互動的即時性。

4. **平行運算加速**：
   - 針對 .NET 10 環境優化多執行緒排程。
   - 自動偵測 CPU 核心數並最大化利用運算資源，顯著提升 Whisper 轉譯速度。

5. **系統長駐與背景執行優化**：
   - **智慧資源調度 (Process Priority)**：自動將處理序優先權設為 `BelowNormal`，確保在背景執行時不干擾遊戲、辦公軟體等主程式。
   - **物件池化 (Object Pooling)**：重複使用錄音器與記憶體緩衝區，取代頻繁的資源建立與銷毀，大幅降低記憶體碎片的產生。
   - **主動記憶體維護 (GC Tuning)**：轉譯完成後自動觸發主動式記憶體回收，適合數日甚至數週的長時間掛載。

6. **幻覺抑制與精準度優化**：
   - **保守解讀模式**：鎖定 `Temperature 0.0`，強制模型僅輸出高信心度的字詞，大幅降低無中生有的「長難句」幻覺。
   - **三重過濾機制**：結合 **語音偵測門檻 (NoSpeech)**、**信心概率 (LogProb)** 與 **背景底噪過濾**，確保安靜環境下畫面的潔淨。
   - **對話引導 (Prompting)**：透過隱形提示語引導模型理解當前為對話狀態，提升「嗨」、「你好」等短促指令的捕捉率。

7. **TTS 語音反饋與保護**：
   - 整合 Windows 原生語音合成引擎（TTS），於啟動時提供語音提醒。
   - **自動避讓機制**：助理說話時會自動暫停麥克風錄音，避免產生音訊回授。



## 模型介紹與特性
本專案目前測試使用的模型為 `ggml-tiny-q5_1.bin`，其主要特性如下：

1. **極致輕量化**：
   - 基於 OpenAI Whisper 的 **Tiny** 架構（僅約 3900 萬個參數）。
   - 檔案體積約 **30 MB**，非常適合用於 Demo 展示或資源受限的硬體環境。

2. **繁體中文優化**：
   - 此模型由 `xmzhu` 針對繁體中文 (`zh-TW`) 進行微調（Fine-tuned）。
   - 相較於官方原生的 Tiny 模型，它在辨識台灣用語與繁體中文轉譯上更加精準。

3. **極速辨識**：
   - 由於模型極小，推論速度（Inference Speed）極快，幾乎可以達到即時辨識的效果。
   - 適合用於簡單的語音指令捕捉或即時對話摘要。

## 繁體中文微調版模型下載
ggml-tiny-zh_tw.bin 模型下載網址:
https://huggingface.co/xmzhu/whisper-tiny-zh-TW/blob/a41e6c9470161b8aa876bd085c780f2396e80164/ggml-tiny-zh_tw.bin
- 74 MB

## .NET 10 升級說明
本專案已從 .NET 6 升級至 **.NET 10**，主要變更包含：

1. **專案檔更新 (`.csproj`)**：
   - 將 `TargetFramework` 修改為 `net10.0`。
   - 將 `Whisper.net` 及其 Runtime 套件升級至 **v1.9.0** 以上版本以支援最新的 .NET 特性。

2. **程式碼適配 (Breaking Changes)**：
   - **WhisperGgmlDownloader**：在新版本中改為非靜態方法，需實例化並傳入 `HttpClient`，同時需指定 `QuantizationType`。
   - **事件處理器**：為了符合 .NET 10 的 Nullability 檢查，將 `AudioRecorder` 中的事件參數 `object sender` 更新為 `object? sender`。

3. **環境需求**：
   - 需安裝 **.NET 10 SDK** 才能進行編譯與開發。
   - 建議使用支援 .NET 10 的 IDE（如 Visual Studio 2022 最新版或 VS Code + C# Dev Kit）。

